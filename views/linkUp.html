<!DOCTYPE html>
<html>
	<head>
		<title>Link to a Budget</title>
        <link rel='stylesheet' type='text/css' href='../public/stylesheets/linkUp.css'/>
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
        <script type='text/javascript' src='../public/javascripts/linkUp.js'></script>
	</head>
	<body>
		<div id="menu">
			<ul>
				<li><a href="home">Home</a></li>
				<li><a href="aboutus">About Us</a></li>
				<li><a href="services">Services</a></li>
				<li><a href="contactus">Contact Us</a></li>
			</ul>
		</div>
		<linkRegistration></linkRegistration>
		<form id="signUp">Primary Owner's E-mail<br><input type="text" id="owners_email" required="required"/><br><br><br>
		E-mail<br><input type="text" id="user_email"/><br><br><br>
		First Name<br><input type="text" id="first_name"/><br><br><br>
		Username<br><input type="text" id="username"/><br><br><br>
		Password<br><input type="password" id="password"/><br><br><br>
		Confirm Password<br><input type="password" id="confirm_password"/><br><br><br>
		Link Code<br><input type="password" id="link_code"/><br><br><br>
		<input type="button" value="Sign Up" id="signUpButton"/>
		</form>
		
		<script>
		$("#signUpButton").click(function()
		{	
			if(document.getElementById("password").value === document.getElementById("confirm_password").value)
			{
				var user = new Object();
				user.owners_email = document.getElementById("owners_email").value;
				user.email = document.getElementById("user_email").value;
				user.name = document.getElementById("first_name").value;
				user.username = document.getElementById("username").value;
				user.password = document.getElementById("password").value;
				user.link_code = document.getElementById("link_code").value;
				
				$.ajax({
					url: '/validateUniqueUser',
					type: 'POST',
					data: user,
					dataType: "json",
					success: function(data){
						if(data)
						{
							$.ajax({
								url: '/validateOwnerAccount',
								type: 'POST',
								data: user,
								dataType: "json",
								success: function(data){
									if(data)
									{	
										window.location.href = "user?" + user.username;
									}
									else
									{
										alert('The budget you would like to connect to does not exists or your link code is incorrect.');
									}
								},
								error: function() {
									alert('An error occured while validating your credentials.');
								}
							});
						}
						else
						{
							alert('A budget with your username and email already exist.');
						}
					},
					error: function() {
						alert('An error occured while validating your credentials.');
					}
				});
			}
			else
			{
				alert('Your password and confirmed password don\'t match');
			}
		});
		</script>
		
		<img id = "currentImage" src="../public/images/linkMessage.png" width="529" height="548" ; style="position:absolute;left:270px;top:100px">	

	</body>
</html>
